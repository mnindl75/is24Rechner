<style scoped>
    #removalplaner-box .list-check > li:before {
        color: #ff7500;
    }
    #removalplaner-box #datepicker {
        cursor: pointer;
    }
    #removalplaner-box #datepicker-holder {
        position: relative;
    }
    #removalplaner-box .unit-icon {
        position: absolute;
        top: 8px;
        right: 0%;
        cursor: pointer;
    }
    @media (min-width: 500px) and (max-width: 1013px){
        #removalplaner-box #removalplaner-box-info {
            margin: 0 auto;
            width: 410px !important;
            float: none;
        }
    }
    @media (min-width: 1013px) {
        #removalplaner-box #removalplaner-box-info p, #removalplaner-box #removalplaner-box-info ul {
            margin-left: 40px;
        }
    }
</style>
<div id="removalplaner-box" class="border padding-xl margin-horizontal-l" data-success-url="https://www.immobilienscout24.de/umzug/eigenregie/umzugsplanung/umzugsplaner_danke/">
    <div class="grid">
        <div class="grid-item palm-one-whole lap-one-whole desk-three-fifths">
            <div id="removal-planer-error-box" class="hide status-message status-error margin-bottom-m">
                <h4>Fehler</h4>
                <p>Bitte überprüfen Sie die rot markierten Felder.</p>
            </div>
            <div id="removal-planer-server-error-box" class="hide status-message status-error margin-bottom-m">
                <h4>Fehler</h4>
                <p>Der Umzugsplanerserver ist leider ausgefallen.</p>
            </div>
            <div id="removal-planer-success-box" class="hide status-message status-confirm margin-bottom-m">
                <h4>Bitte bestätigen Sie Ihre E-Mail-Adresse.</h4>
                <p>Klicken Sie dazu auf den Bestätigungs-Link in der E-Mail, die wir Ihnen gesendet haben.</p>
            </div>

            <div class="grid margin-bottom-m">
                <div class="grid-item grid palm-one-whole lap-one-half desk-one-half margin-top-xs">
                    <span class="grid-item one-eighth fa fa-calendar font-xl font-brandorange margin-top-xs"></span>
                    <span class="grid-item seven-eighths font-l font-semibold font-info padding-horizontal-s">Ihr Umzugstermin*</span>
                </div>
                <div id="datepicker-holder" class="grid-item palm-one-whole lap-one-half desk-one-half">
                    <input readonly="readonly" autocomplete="off" id="datepicker" type="text" class="input-text one-whole" placeholder="TT MM JJJJ"/>
                    <span class="unit-icon fa fa-calendar-o pointer" id="trigger"></span>
                </div>
                <p id="status-text-date" class="grid-item one-whole font-s margin-bottom-s font-error">&nbsp;</p>
            </div>
            <div class="grid margin-bottom-m">
                <div class="grid-item grid palm-one-whole lap-one-half desk-one-half margin-top-xs">
                    <span class="grid-item one-eighth fa fa-envelope-o font-xl font-brandorange margin-top-xs"></span>
                    <span class="grid-item seven-eighths font-l font-semibold font-info padding-horizontal-s">Ihre E-Mail-Adresse*</span>
                </div>
                <div class="grid-item palm-one-whole lap-one-half desk-one-half">
                    <input id="removal-planer-email" type="text" class="input-text one-whole" placeholder="muster@beispiel.de"/>
                </div>
                <p id="status-text-email" class="grid-item one-whole font-s margin-bottom-s font-error">&nbsp;</p>
            </div>
            <div>
                <input type="checkbox" class="input-checkbox" id="data-privacy" name="data-privacy"/>
                <label for="data-privacy" class="label-radio">
                    Ich stimme der <a href="https://www.immobilienscout24.de/agb/datenschutz/Datenschutzeinwilligung/" target="_blank">Datenschutzeinwilligung</a>
                    von ImmobilienScout24 zu.*
                </label>
                <p id="status-text-data-privacy" class="grid-item one-whole font-s margin-bottom-s font-error">&nbsp;</p>
            </div>
            <p class="margin-bottom-m">*Pflichtangabe</p>
            <div class="align-center palm-one-whole lap-one-whole desk-four-fifths">
                <button class="button-secondary padding-horizontal-xxl font-m">Jetzt Umzug planen</button>
            </div>
            <p class="desk-hide">&nbsp;</p>
        </div>
        <div id="removalplaner-box-info" class="grid-item palm-one-whole lap-one-whole desk-two-fifths">
            <p class="font-l font-semibold font-info margin-bottom-m margin-top-xs">Vorteile des Umzugsplaners:</p>
            <ul class="list-check">
                <li class="font-m margin-bottom-s">Individuellen Umzugsplan per E-Mail erhalten</li>
                <li class="font-m margin-bottom-s">Erinnerungen für alle wichtigen Aufgaben</li>
                <li class="font-m">Profitieren Sie von unseren Umzugstipps</li>
            </ul>
        </div>

    </div>

</div>
<script>


    /*global window */
    /*global document */
    /*global $ */
    /*global alert */
    /*global google */
    /*global jQuery */
    /*global Image*/
    /*global de */
    var de = de || {};
    de.is24 = de.is24 || {};
    de.is24.umzug = de.is24.umzug || {};

    de.is24.umzug.umzugsplaner3 = de.is24.umzug.umzugsplaner3 || (function ($) {
                "use strict";
                var isTeliumActivated;
                function initRemovalPlaner() {
                    var $removalPlanerErrorBox = $('#removal-planer-error-box'),
                            $removalPlanerServerErrorBox = $('#removal-planer-server-error-box'),
                            $removalPlanerSuccessBox = $('#removal-planer-success-box'),
                            $datepicker = $('#datepicker'),
                            $email = $('#removal-planer-email'),
                            $dataPrivacy = $('#data-privacy'),
                            email_reg_link = "/umzugsexpose/umzugsplaner/createEmails",
                            $status_text_date = $('#status-text-date'),
                            $status_text_email = $('#status-text-email'),
                            $status_text_dataPrivacy = $('#status-text-data-privacy'),
                            error_text_date = "Bitte wählen Sie einen Umzugstermin aus.",
                            error_text_email_wrong = "Bitte geben Sie eine gültige E-Mail Adresse ein.",
                            error_text_dataPrivacy = "Bitte bestätigen Sie die Datenschutzeinwilligung.";


                    function initDatepicker() {
                        $.datepicker.regional.de = {
                            monthNames: ['Januar', 'Februar', 'M&#228;rz', 'April', 'Mai', 'Juni',
                                'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
                            monthNamesShort: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun',
                                'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
                            dayNamesShort: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
                            dayNamesMin: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa']
                        };
                        $.datepicker.setDefaults($.datepicker.regional.de);
                        $datepicker.datepicker({
                            inline: true,
                            dateFormat: 'dd.mm.yy',
                            onSelect: function() {
                                $status_text_date.html('&nbsp;');
                                $removalPlanerErrorBox.removeClass('block').addClass('hide');
                                $datepicker.removeClass('error');
                            },
                            minDate: 1
                        });
                    }
                    function register() {
                        var removal_date = $datepicker.datepicker("getDate"),
                                datepicker_value = $datepicker.val(),
                                email_value = $email.val(),
                                is_data_privacy  = $dataPrivacy.is(':checked');

                        if (!datepicker_value.length > 0) {
                            $status_text_date.text(error_text_date).fadeIn(1000);
                            $datepicker.addClass('error');
                            $removalPlanerErrorBox.removeClass('hide').addClass('block');
                        }
                        if (!email_value.length > 0 ) {
                            $status_text_email.text(error_text_email_wrong).fadeIn(1000);
                            $email.addClass('error');
                            $removalPlanerErrorBox.removeClass('hide').addClass('block');
                        }
                        if(!is_data_privacy) {
                            $status_text_dataPrivacy.text(error_text_dataPrivacy).fadeIn(1000);
                            $dataPrivacy.addClass('error');
                            $removalPlanerErrorBox.removeClass('hide').addClass('block');
                        }

                        if (datepicker_value.length > 0 && email_value.length > 0 && is_data_privacy) {
                            $.ajax( {
                                url: email_reg_link,
                                async: false,
                                data: {
                                    "movingDate" : removal_date.getDate().toString() + '.' +
                                    ( removal_date.getMonth() + 1 ) + '.' + removal_date.getFullYear(),
                                    "email" : email_value,
                                    "faxnumber": "",
                                    "dataPrivacy": true,
                                    "successUrl": $('#removalplaner-box').attr('data-success-url')
                                },
                                success: function(data) {
                                    if (data.status === "500") {
                                        $removalPlanerServerErrorBox.removeClass("hide").addClass('block');
                                    } else {
                                        $removalPlanerServerErrorBox.removeClass("block").addClass('hide');
                                        if (data.status === "400") {
                                            $removalPlanerErrorBox.removeClass('hide').addClass('block');
                                            if (!data.email) {
                                                $status_text_email.text(error_text_email_wrong).fadeIn(1000);
                                                $email.addClass('error');
                                            }
                                            if (!data.movingDate) {
                                                $status_text_date.text(error_text_date).fadeIn(1000);
                                                $datepicker.addClass('error');
                                            }
                                            if (!data.dataPrivacy) {
                                                $status_text_dataPrivacy.text(error_text_dataPrivacy).fadeIn(1000);
                                                $dataPrivacy.addClass('error');
                                            }
                                        } else if (data.status === "200") {
                                            $removalPlanerSuccessBox.removeClass("hide").addClass('block');
                                            if (isTeliumActivated) {
                                                IS24.TEALIUM.tracking.report({
                                                    evt_ga_category: 'relocation',
                                                    evt_ga_action: 'planner',
                                                    evt_ga_label: 'generate'
                                                });
                                            }
                                        }
                                    }
                                }
                            });
                        }
                    }

                    function writeCSSForDatepickerInHead() {
                        var $head = $('head');
                        $head.append('<link type="text/css" href="/umzugsexpose/css/umzugsplaner/removalplanerForRemovalStartpage.css" rel="stylesheet"/>');
                    }

                    writeCSSForDatepickerInHead();
                    initDatepicker();
                    $('#trigger').click(function() {
                        $datepicker.datepicker('show');
                    });
                    $email.focus(function() {
                        $status_text_email.html('&nbsp;');
                        $email.removeClass('error');
                        $removalPlanerErrorBox.removeClass('block').addClass('hide');
                    });
                    $dataPrivacy.click(function() {
                        $status_text_dataPrivacy.html('&nbsp;');
                        $dataPrivacy.removeClass('error');
                        $removalPlanerErrorBox.removeClass('block').addClass('hide');
                    });
                    $('#removalplaner-box .button-secondary').click(function (e) {
                        e.preventDefault();
                        register();
                    });
                }
                function init() {
                    isTeliumActivated = typeof ( window.IS24 && IS24.TEALIUM && IS24.TEALIUM.tracking && IS24.TEALIUM.tracking.report ) !== 'undefined';
                    initRemovalPlaner();
                }
                return {
                    init: init
                };
            })(jQuery);
    /*funktioniert leider nicht immer bei ready*/
    jQuery(window).load(function () {
        "use strict";
        de.is24.umzug.umzugsplaner3.init();
    });
</script>
