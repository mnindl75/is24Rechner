<link href="/corecss/core.css">
<style scoped>
    #removalplaner-box .list-check > li:before {
        color: #ff7500;
    }
    #removalplaner-box #datepicker {
        cursor: pointer;
    }
    #removalplaner-box .unit-icon {
        margin-left: -2em;
        cursor: pointer;
    }

</style>
<div id="removalplaner-box" class="grid border padding-xxl gutter-horizontal-m">
    <div class="grid-item palm-one-whole lap-three-fifths desk-three-fifths">
        <div id="removal-planer-error-box" class="hide status-message status-error margin-bottom-m margin-right-m">
            <h4>Fehler</h4>
            <p>Bitte überprüfen Sie die rot markierten Felder</p>
        </div>
        <div id="removal-planer-server-error-box" class="hide status-message status-error margin-bottom-m margin-right-m">
            <h4>Fehler</h4>
            <p>Der Umzugsplanerserver ist leider ausgefallen.</p>
        </div>
        <div id="removal-planer-success-box" class="hide status-message status-confirm margin-bottom-m margin-right-m">
            <h4>Sie haben sich erfolgreich für die Erinnerungsmails registriert.</h4>
        </div>

        <div class="grid margin-bottom-m">
            <div class="grid-item palm-one-whole lap-one-half desk-one-half margin-top-xs">
                <span class="fa fa-calendar font-xl"></span>
                <span class="font-l font-bold padding-horizontal-m">Ihr Umzugstermin</span>
            </div>
            <div class="grid-item palm-one-whole lap-one-half desk-one-half">
                <input autocomplete="off" id="datepicker" type="text" class="input-text one-whole" placeholder="TT MM JJJJ"/>
                <span class="unit-icon fa fa-calendar-o pointer" id="trigger"></span>
            </div>
            <p id="status-text-date" class="grid-item one-whole font-s margin-bottom-s font-error">&nbsp;</p>
        </div>
        <div class="grid margin-bottom-m padding-top-m">
            <div class="grid-item palm-one-whole lap-one-half desk-one-half margin-top-xs">
                <span class="fa fa-envelope-o font-xl"></span>
                <span class="font-l font-bold padding-horizontal-m">Ihre E-Mail-Adresse</span>    
            </div>
            <div class="grid-item palm-one-whole lap-one-half desk-one-half">
                <input id="removal-planer-email" type="text" class="input-text one-whole" placeholder="muster@beispiel.de"/>
            </div>
            <p id="status-text-email" class="grid-item one-whole font-s margin-bottom-s font-error">&nbsp;</p>
        </div>
        <div>
            <input type="checkbox" class="input-checkbox" id="data-privacy" name="data-privacy"/>
            <label for="data-privacy" class="label-radio">
                Ich stimme der <a href="http://www.immobilienscout24.de/agb/datenschutz/Datenschutzeinwilligung/" target="_blank">Datenschutzeinwilligung</a>
                von ImmobilienScout24 zu.
            </label>
            <p id="status-text-data-privacy" class="grid-item one-whole font-s margin-bottom-s font-error">&nbsp;</p>
        </div>
        <div class="palm-hide align-center four-fifths">
            <button class="button-primary padding-horizontal-xxl">Jetzt Umzug planen</button>
        </div>
    </div>
    <div class="grid-item palm-one-whole lap-two-fifths desk-two-fifths">
        <p class="font-l font-bold font-info margin-bottom-m margin-top-xs">Vorteile des Umzugsplaners:</p>
        <ul class="list-check">
            <li class="font-l margin-bottom-s">Individuellen Umzugsplan per E-Mail erhalten</li>
            <li class="font-l margin-bottom-s">Erinnerungen für alle wichtigen Aufgaben</li>
            <li class="font-l">Profitieren Sie von unseren Umzugs-Tipps</li>
        </ul>
    </div>
    <div class="grid-item one-whole desk-hide lap-hide align-center margin-top-l">
        <button class="button-primary padding-horizontal-xxl">Jetzt Umzug planen</button>
    </div>
</div>
<script>


    /*global window */
    /*global document */
    /*global $ */
    /*global alert */
    /*global google */
    /*global jQuery */
    /*global Image*/
    /*global de */
    var de = de || {};
    de.is24 = de.is24 || {};
    de.is24.umzug = de.is24.umzug || {};
    
    de.is24.umzug.umzugsplanerRubrikStartPageV2 = de.is24.umzug.umzugsplanerRubrikStartPageV2 || (function ($) {
        "use strict";
        function initRemovalPlaner() {
            var $removalPlanerErrorBox = $('#removal-planer-error-box'), 
                $removalPlanerServerErrorBox = $('#removal-planer-server-error-box'),
                $removalPlanerSuccessBox = $('#removal-planer-success-box'),
                $datepicker = $('#datepicker'),
                $email = $('#removal-planer-email'),
                $dataPrivacy = $('#data-privacy'),
                email_reg_link = "/umzugsexpose/umzugsplaner/createEmails",
                $status_text = $('#status-text'),
                $status_text_date = $('#status-text-date'),
                $status_text_email = $('#status-text-email'),
                $status_text_dataPrivacy = $('#status-text-data-privacy'),
                error_text_date = "Bitte geben Sie Ihren Umzugstermin ein.",
                error_text_email_wrong = "Bitte geben Sie eine gültige E-Mail Adresse ein.",
                error_text_dataPrivacy = "Bitte bestätigen Sie die AGB.",
                text_email_right = "Sie haben sich erfolgreich für die Erinnerungsmails registriert.",
                error_text_server = "Der Umzugsplanerserver ist leider ausgefallen.";


            function initDatepicker() {

                $.datepicker.regional.de = {
                    monthNames: ['Januar', 'Februar', 'M&#228;rz', 'April', 'Mai', 'Juni',
                        'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'],
                    monthNamesShort: ['Jan', 'Feb', 'Mär', 'Apr', 'Mai', 'Jun',
                        'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
                    dayNamesShort: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
                    dayNamesMin: ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'],
                    weekHeader: 'Wo',
                    dateFormat: 'dd.mm.yy',
                    minDate: 1,
                    showMonthAfterYear: true,
                    showAnim: 'fold',
                    onSelect: function () {
                        $status_text_date.html('&nbsp;');
                        $removalPlanerErrorBox.removeClass('block').addClass('hide');
                    }
                };
                $.datepicker.setDefaults($.datepicker.regional.de);
                $datepicker.datepicker();
            }
            function register() {
                var removal_date = $datepicker.datepicker("getDate"), 
                    email_value = $email.val();
                    
                if ($datepicker.val().length > 0) {
                    if (email_value.length > 0 ) {
                        if($dataPrivacy.is(':checked')) {
                            $.ajax( {
                                url: email_reg_link,
                                async: false,
                                data: {
                                    "movingDate" : removal_date.getDate().toString() + '.' +
                                    ( removal_date.getMonth() + 1 ) + '.' + removal_date.getFullYear(),
                                     "email" : email_value,
                                     "faxnumber": "",
                                    "data-privacy": true
                                },
                                success: function(data) {
                                    if (data.status === "500") {
                                        $removalPlanerServerErrorBox.removeClass("hide").addClass('block');
                                    } else {
                                        $removalPlanerServerErrorBox.removeClass("block").addClass('hide');
                                        if (data.status === "400") {
                                            $removalPlanerErrorBox.removeClass('hide').addClass('block');
                                            if (!data.email) {
                                                $status_text_email.text(error_text_email_wrong).fadeIn(1000);
                                            }
                                            if (!data.removal-date) {
                                                $status_text_date.text(error_text_date).fadeIn(1000);
                                            }
                                            if (!data.data-privacy) {
                                                $status_text_dataPrivacy.text(error_text_dataPrivacy).fadeIn(1000);
                                            }
                                        } else if (data.status === "200") {
                                            $removalPlanerSuccessBox.removeClass("hide").addClass('block');
                                        }
                                    } 
                                }
                            }); 
                        } else {
                            $status_text_dataPrivacy.text(error_text_dataPrivacy).fadeIn(1000);
                            $removalPlanerErrorBox.removeClass('hide').addClass('block');
                        }
                        
                    } else {
                        $status_text_email.text(error_text_email_wrong).fadeIn(1000);
                        $removalPlanerErrorBox.removeClass('hide').addClass('block');
                    }
                } else {
                    $status_text_date.text(error_text_date).fadeIn(1000);
                    $removalPlanerErrorBox.removeClass('hide').addClass('block');
                }
                
            }

            function writeCSSForDatepickerInHead() {
                var $head = $('head');
                $head.append('<link type="text/css" href="/umzugsexpose/css/umzugsplaner/removalplanerForRemovalStartpage.css" rel="stylesheet"/>');
            }

            writeCSSForDatepickerInHead();
            initDatepicker();
            $('#trigger').click(function() {
                $datepicker.datepicker('show');
            });
            $email.focus(function() {
                $status_text_email.html('&nbsp;');
                $removalPlanerErrorBox.hide();
                $removalPlanerErrorBox.removeClass('block').addClass('hide');
            });
            $dataPrivacy.click(function() {
                $status_text_dataPrivacy.html('&nbsp;');
                $removalPlanerErrorBox.removeClass('block').addClass('hide');
            });
            $('#removalplaner-box .button-primary').click(function (e) {
                e.preventDefault();
                register();
            });
        }
        function init() {
            initRemovalPlaner();
        }
        return {
            init: init
        };
    })(jQuery);
    /*funktioniert leider nicht immer bei ready*/
    jQuery(window).load(function () {
        "use strict";
        de.is24.umzug.umzugsplanerRubrikStartPageV2.init();
    });
</script>


